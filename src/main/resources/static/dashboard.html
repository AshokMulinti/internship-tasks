<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
</head>
<body>

<h2>Dashboard</h2>
<p id="welcomeMsg">Loading...</p>

<script>
    const token = localStorage.getItem("token");

    fetch("http://localhost:8080/api/dashboard", {
        headers: {
            "Authorization": "Bearer " + token
        }
    })
    .then(async response => {
        if (!response.ok) {
            const contentType = response.headers.get("Content-Type") || "";

            let errorText = "";
            if (contentType.includes("application/json")) {
                const errorJson = await response.json();
                errorText = errorJson.error || "";
            } else {
                errorText = await response.text();
            }

            //  Show only if token expired
            if (response.status === 401 && errorText.toLowerCase().includes("expired")) {
                alert("Token expired. Please login again.");
                localStorage.removeItem("token");
                window.location.href = "index.html";
                return;
            }

            //  Don't show anything for other unauthorized cases
            return;
        }

        //  Success
        const data = await response.text();
        document.getElementById("welcomeMsg").innerText = data;
    })
    .catch(() => {
        // Optional: Only for network issues
        alert("Something went wrong. Try again.");
        window.location.href = "index.html";
    });
</script>

</body>
</html>
